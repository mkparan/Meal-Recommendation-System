<!DOCTYPE html>
<html>
  <head>
    <title>AI Meal Recommender</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link href="/static/style.css" rel="stylesheet" />
  </head>
  <body>
    <div class="container mt-5">
      <h1 class="text-center mb-4">AI Meal Recommender</h1>

      <div class="card shadow">
        <div class="card-body">
          <form id="recommendForm">
            <h4 class="mb-3">Nutritional Requirements</h4>
            <div class="row g-3">
              <div class="col-md-3">
                <label class="form-label">Max Calories</label>
                <input
                  type="number"
                  class="form-control"
                  name="calories"
                  required
                />
              </div>
              <div class="col-md-3">
                <label class="form-label">Min Protein (g)</label>
                <input
                  type="number"
                  class="form-control"
                  name="protein"
                  required
                />
              </div>
              <div class="col-md-3">
                <label class="form-label">Max Carbs (g)</label>
                <input
                  type="number"
                  class="form-control"
                  name="carbs"
                  required
                />
              </div>
              <div class="col-md-3">
                <label class="form-label">Max Fat (g)</label>
                <input type="number" class="form-control" name="fat" required />
              </div>
            </div>

            <div class="mt-3">
              <label class="form-label"
                >Ingredients to Include (comma separated)</label
              >
              <input
                type="text"
                class="form-control"
                name="ingredients"
                placeholder="e.g., chicken, rice, broccoli"
              />
            </div>

            <button type="submit" class="btn btn-primary mt-3">
              Get Recommendations
            </button>
          </form>
        </div>
      </div>

      <div id="results" class="mt-4"></div>
    </div>

    <!-- Modal -->
    <div
      class="modal fade"
      id="mealModal"
      tabindex="-1"
      aria-labelledby="mealModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="mealModalLabel">Meal Details</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body" id="mealModalBody">
            <!-- Meal info will be injected here -->
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script>
      document
        .getElementById("recommendForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const formData = new FormData(e.target);
          const ingredients = formData
            .get("ingredients")
            .split(",")
            .map((i) => i.trim())
            .filter((i) => i.length > 0);

          const response = await fetch("/recommend", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              calories: formData.get("calories"),
              protein: formData.get("protein"),
              carbs: formData.get("carbs"),
              fat: formData.get("fat"),
              ingredients: ingredients,
            }),
          });

          const results = await response.json();
          console.log("Results from server:", results);

          if (!Array.isArray(results) || results.length === 0) {
            document.getElementById("results").innerHTML =
              "<p class='text-danger'>No meals matched your criteria.</p>";
            return;
          }

          displayResults(results);
        });

      function displayResults(meals) {
        let html = '<h3 class="mb-3">Recommended Meals</h3><div class="row">';

        meals.forEach((meal) => {
          html += `
            <div class="col-md-4 mb-4">
              <div class="card h-100 meal-card" onclick='showDetails(${JSON.stringify(
                meal
              )})'>
                
                <div class="card-body">
                  <h5 class="card-title">${meal.name}</h5>
                  <div class="nutrition-badges">
                    <span class="badge bg-primary">${
                      meal.nutrition.calories
                    } cal</span>
                    <span class="badge bg-success">${
                      meal.nutrition.protein
                    }g protein</span>
                    <span class="badge bg-warning">${
                      meal.nutrition.carbs
                    }g carbs</span>
                    <span class="badge bg-danger">${
                      meal.nutrition.fat
                    }g fat</span>
                  </div>
                </div>
              </div>
            </div>`;
        });

        document.getElementById("results").innerHTML = html + "</div>";
      }

      function showDetails(meal) {
        const modalBody = document.getElementById("mealModalBody");
        modalBody.innerHTML = `
          <h5>${meal.name}</h5>
          <p><strong>Ingredients:</strong> ${meal.ingredients.join(", ")}</p>
          <p><strong>Tags:</strong> ${meal.tags?.join(", ") || "None"}</p>
          <p><strong>Nutrition:</strong></p>
          <ul>
            <li>Calories: ${meal.nutrition.calories} cal</li>
            <li>Protein: ${meal.nutrition.protein} g</li>
            <li>Carbs: ${meal.nutrition.carbs} g</li>
            <li>Fat: ${meal.nutrition.fat} g</li>
          </ul>
          <p><strong>Instructions:</strong> ${
            meal.instructions || "No instructions provided."
          }</p>
        `;

        const modal = new bootstrap.Modal(document.getElementById("mealModal"));
        modal.show();
      }
    </script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
